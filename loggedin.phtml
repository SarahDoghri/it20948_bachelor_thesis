<?php
session_start();
// echo "Session ID: " . session_id();
/*** από εδώ ---------> */

// Prevent browser from caching this page
header("Cache-Control: no-store, no-cache, must-revalidate, max-age=0");
header("Cache-Control: post-check=0, pre-check=0", false);
header("Pragma: no-cache");
header("Expires: Sat, 26 Jul 1997 05:00:00 GMT");

// Check if user is logged in
if (!isset($_SESSION['username'])) {
    header("Location: index.html");
    exit();
}
/*** <-------- ως εδώ */

// Check if the user is authenticated
if (!isset($_SESSION["username"])) {
    header("Location?!: index.html"); // Redirect to login page
    exit();
}

// The rest of your logged-in page content goes here
?>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Πίνακας Χρήστη</title>
    <script>
        // Get the username from the URL query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('username');

        // Function to handle logout
        function logout() {
            window.location.href = "logout.php";
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        window.addEventListener('pageshow', function(event) {
            if (event.persisted || (window.performance && window.performance.getEntriesByType('navigation')[0].type === 'back_forward')) {
                // Reload the page if loaded from cache (back/forward navigation)
                window.location.reload();
            }
        });
    </script>
    <link rel="stylesheet" type="text/css" href="style/user.css">
</head>
<body>
    <div class="main" id="myaccount">
        <div class="container-wrapper">
            <!-- <h2 id="welcomeMessage">Welcome, User!</h2> -->

            <h2>Καλωσήρθες, <?php echo $_SESSION["username"]; ?>!</h2>
            <div class="content">
                <p>Λίστα με τα διαθέσιμα quiz του φοιτητή</p>
                <?php
                    // Database connection parameters
                    $host = 'localhost';
                    $username = 'root';
                    $password = '';
                    $database = 'test';

                    // Create a database connection
                    $mysqli = new mysqli($host, $username, $password, $database);

                    // Check the connection
                    if ($mysqli->connect_error) {
                        die("Connection failed: " . $mysqli->connect_error);
                    }

                    // SQL query to retrieve course IDs and names where active state is 1
                    $sql = "SELECT course_id, course_name FROM courses WHERE active = 1";
                    $result = $mysqli->query($sql);

                    // Initialize an empty array to store course data
                    $courseData = array();

                    // Check if there are any rows returned
                    if ($result->num_rows > 0) {
                        while ($row = $result->fetch_assoc()) {
                            // Store course data in the array
                            $courseData[] = $row;
                        }
                    }

                    // Close the database connection
                    $mysqli->close();
?>
                <form id="selectionForm" class="selectionForm">
                    <p>Μαθήματα προς εξέταση</p>
                    <label for="dropdown">Επιλογή quiz:</label>
                    <select id="dropdown" name="selectedOption">
                        <?php
                        // Generate dropdown options based on course data
                        foreach ($courseData as $course) {
                            echo '<option value="' . $course['course_id'] . '">' . $course['course_name'] . '</option>';
                        }
                        ?>
                    </select>
                    <button type="button" onclick="redirectToPage()">Έναρξη quiz</button>
                </form>
            
                <script>
                    function redirectToPage() {
                        var selectedValue = document.getElementById('dropdown').value;
                        window.location.href = 'new_test.phtml?selectedOption=' + selectedValue + '&' + document.querySelector(`option[value="${selectedValue}"]`).innerText;
                    }
                </script>
            </div>
            
            <button id="logout" onclick="logout()">Έξοδος</button>
        </div>
    </div>
    
</body>
</html>


<script>
// Example using jQuery
jQuery.ajax({
    type: "GET",
    url: "get_session_data.php",
    success: function(response) {
        // Use the response (session data) in JavaScript
    }
});


</script>